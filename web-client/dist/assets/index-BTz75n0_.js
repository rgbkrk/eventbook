(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();let i,v=null;function L(){return(v===null||v.byteLength===0)&&(v=new Uint8Array(i.memory.buffer)),v}let j=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});j.decode();const H=2146435072;let M=0;function C(r,e){return M+=e,M>=H&&(j=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),j.decode(),M=e),j.decode(L().subarray(r,r+e))}function l(r,e){return r=r>>>0,C(r,e)}function h(r){const e=i.__externref_table_alloc();return i.__wbindgen_export_2.set(e,r),e}function y(r,e){try{return r.apply(this,e)}catch(t){const n=h(t);i.__wbindgen_exn_store(n)}}let d=0;const S=new TextEncoder;"encodeInto"in S||(S.encodeInto=function(r,e){const t=S.encode(r);return e.set(t),{read:r.length,written:t.length}});function u(r,e,t){if(t===void 0){const _=S.encode(r),c=e(_.length,1)>>>0;return L().subarray(c,c+_.length).set(_),d=_.length,c}let n=r.length,s=e(n,1)>>>0;const o=L();let a=0;for(;a<n;a++){const _=r.charCodeAt(a);if(_>127)break;o[s+a]=_}if(a!==n){a!==0&&(r=r.slice(a)),s=t(s,n,n=a+r.length*3,1)>>>0;const _=L().subarray(s+a,s+n),c=S.encodeInto(r,_);a+=c.written,s=t(s,n,a,1)>>>0}return d=a,s}let g=null;function T(){return(g===null||g.buffer.detached===!0||g.buffer.detached===void 0&&g.buffer!==i.memory.buffer)&&(g=new DataView(i.memory.buffer)),g}function m(r){return r==null}const D=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>{i.__wbindgen_export_6.get(r.dtor)(r.a,r.b)});function N(r,e,t,n){const s={a:r,b:e,cnt:1,dtor:t},o=(...a)=>{s.cnt++;const _=s.a;s.a=0;try{return n(_,s.b,...a)}finally{--s.cnt===0?(i.__wbindgen_export_6.get(s.dtor)(_,s.b),D.unregister(s)):s.a=_}};return o.original=s,D.register(o,s,s),o}function f(r){const e=i.__wbindgen_export_2.get(r);return i.__externref_table_dealloc(r),e}function P(r){const e=u(r,i.__wbindgen_malloc,i.__wbindgen_realloc),t=d,n=i.validate_json_payload(e,t);if(n[1])throw f(n[0])}function q(r,e,t){i.closure37_externref_shim(r,e,t)}function J(r,e,t,n){i.closure58_externref_shim(r,e,t,n)}const O=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_eventbookclient_free(r>>>0,1));class ${__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,O.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_eventbookclient_free(e,0)}constructor(e){const t=u(e,i.__wbindgen_malloc,i.__wbindgen_realloc),n=d,s=i.eventbookclient_new(t,n);return this.__wbg_ptr=s>>>0,O.register(this,this.__wbg_ptr,this),this}submit_event(e,t,n){const s=u(e,i.__wbindgen_malloc,i.__wbindgen_realloc),o=d,a=u(t,i.__wbindgen_malloc,i.__wbindgen_realloc),_=d,c=u(n,i.__wbindgen_malloc,i.__wbindgen_realloc),z=d,p=i.eventbookclient_submit_event(this.__wbg_ptr,s,o,a,_,c,z);if(p[2])throw f(p[1]);return b.__wrap(p[0])}get_events(){const e=i.eventbookclient_get_events(this.__wbg_ptr);if(e[2])throw f(e[1]);return f(e[0])}get_events_for_aggregate(e){const t=u(e,i.__wbindgen_malloc,i.__wbindgen_realloc),n=d,s=i.eventbookclient_get_events_for_aggregate(this.__wbg_ptr,t,n);if(s[2])throw f(s[1]);return f(s[0])}get_materialized_users(){return i.eventbookclient_get_materialized_users(this.__wbg_ptr)}get_materialized_user(e){const t=u(e,i.__wbindgen_malloc,i.__wbindgen_realloc),n=d,s=i.eventbookclient_get_materialized_user(this.__wbg_ptr,t,n);return s===0?void 0:w.__wrap(s)}get_user_count(){return i.eventbookclient_get_user_count(this.__wbg_ptr)>>>0}get_event_count(){return i.eventbookclient_get_event_count(this.__wbg_ptr)>>>0}clear_local_store(){i.eventbookclient_clear_local_store(this.__wbg_ptr)}rebuild_projections(){const e=i.eventbookclient_rebuild_projections(this.__wbg_ptr);if(e[2])throw f(e[1]);return e[0]>>>0}sync_event_log(){return i.eventbookclient_sync_event_log(this.__wbg_ptr)}}Symbol.dispose&&($.prototype[Symbol.dispose]=$.prototype.free);const I=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_jsevent_free(r>>>0,1));class b{static __wrap(e){e=e>>>0;const t=Object.create(b.prototype);return t.__wbg_ptr=e,I.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,I.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_jsevent_free(e,0)}constructor(e,t,n,s,o,a){const _=u(e,i.__wbindgen_malloc,i.__wbindgen_realloc),c=d,z=u(t,i.__wbindgen_malloc,i.__wbindgen_realloc),p=d,x=u(n,i.__wbindgen_malloc,i.__wbindgen_realloc),F=d,A=u(s,i.__wbindgen_malloc,i.__wbindgen_realloc),B=d,W=i.jsevent_new(_,c,z,p,x,F,A,B,o,a);return this.__wbg_ptr=W>>>0,I.register(this,this.__wbg_ptr,this),this}get id(){let e,t;try{const n=i.jsevent_id(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}get event_type(){let e,t;try{const n=i.jsevent_event_type(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}get aggregate_id(){let e,t;try{const n=i.jsevent_aggregate_id(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}get payload(){let e,t;try{const n=i.jsevent_payload(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}get timestamp(){return i.jsevent_timestamp(this.__wbg_ptr)}get version(){return i.jsevent_version(this.__wbg_ptr)}}Symbol.dispose&&(b.prototype[Symbol.dispose]=b.prototype.free);const U=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_jsuser_free(r>>>0,1));class w{static __wrap(e){e=e>>>0;const t=Object.create(w.prototype);return t.__wbg_ptr=e,U.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,U.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_jsuser_free(e,0)}get id(){let e,t;try{const n=i.jsuser_id(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}get name(){let e,t;try{const n=i.jsuser_name(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}get email(){let e,t;try{const n=i.jsuser_email(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}get created_at(){return i.jsevent_timestamp(this.__wbg_ptr)}get updated_at(){return i.jsevent_version(this.__wbg_ptr)}get active(){return i.jsuser_active(this.__wbg_ptr)!==0}}Symbol.dispose&&(w.prototype[Symbol.dispose]=w.prototype.free);const R=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_syncresult_free(r>>>0,1));class E{static __wrap(e){e=e>>>0;const t=Object.create(E.prototype);return t.__wbg_ptr=e,R.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_syncresult_free(e,0)}get events_pulled(){return i.syncresult_events_pulled(this.__wbg_ptr)>>>0}get success(){return i.syncresult_success(this.__wbg_ptr)!==0}get error_message(){const e=i.syncresult_error_message(this.__wbg_ptr);let t;return e[0]!==0&&(t=l(e[0],e[1]).slice(),i.__wbindgen_free(e[0],e[1]*1,1)),t}}Symbol.dispose&&(E.prototype[Symbol.dispose]=E.prototype.free);const V=new Set(["basic","cors","default"]);async function G(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.ok&&V.has(r.type)&&r.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function X(){const r={};return r.wbg={},r.wbg.__wbg_Error_e17e777aac105295=function(e,t){return Error(l(e,t))},r.wbg.__wbg_call_13410aac570ffff7=function(){return y(function(e,t){return e.call(t)},arguments)},r.wbg.__wbg_call_a5400b25a865cfd8=function(){return y(function(e,t,n){return e.call(t,n)},arguments)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let n,s;try{n=e,s=t,console.error(l(e,t))}finally{i.__wbindgen_free(n,s,1)}},r.wbg.__wbg_fetch_44b6058021aef5e3=function(e,t){return e.fetch(t)},r.wbg.__wbg_headers_af04c3eb495104ed=function(e){return e.headers},r.wbg.__wbg_instanceof_Response_50fde2cd696850bf=function(e){let t;try{t=e instanceof Response}catch{t=!1}return t},r.wbg.__wbg_instanceof_Window_12d20d558ef92592=function(e){let t;try{t=e instanceof Window}catch{t=!1}return t},r.wbg.__wbg_jsevent_new=function(e){return b.__wrap(e)},r.wbg.__wbg_jsuser_new=function(e){return w.__wrap(e)},r.wbg.__wbg_log_6c7b5f4f00b8ce3f=function(e){console.log(e)},r.wbg.__wbg_new_19c25a3f2fa63a02=function(){return new Object},r.wbg.__wbg_new_1f3a344cf3123716=function(){return new Array},r.wbg.__wbg_new_2e3c58a15f39f5f9=function(e,t){try{var n={a:e,b:t},s=(a,_)=>{const c=n.a;n.a=0;try{return J(c,n.b,a,_)}finally{n.a=c}};return new Promise(s)}finally{n.a=n.b=0}},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_newnoargs_254190557c45b4ec=function(e,t){return new Function(l(e,t))},r.wbg.__wbg_newwithstrandinit_b5d168a29a3fd85f=function(){return y(function(e,t,n){return new Request(l(e,t),n)},arguments)},r.wbg.__wbg_ok_2eac216b65d90573=function(e){return e.ok},r.wbg.__wbg_push_330b2eb93e4e1212=function(e,t){return e.push(t)},r.wbg.__wbg_queueMicrotask_25d0739ac89e8c88=function(e){queueMicrotask(e)},r.wbg.__wbg_queueMicrotask_4488407636f5bf24=function(e){return e.queueMicrotask},r.wbg.__wbg_resolve_4055c623acdd6a1b=function(e){return Promise.resolve(e)},r.wbg.__wbg_set_1c17f9738fac2718=function(){return y(function(e,t,n,s,o){e.set(l(t,n),l(s,o))},arguments)},r.wbg.__wbg_setmethod_9b504d5b855b329c=function(e,t,n){e.method=l(t,n)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const n=t.stack,s=u(n,i.__wbindgen_malloc,i.__wbindgen_realloc),o=d;T().setInt32(e+4*1,o,!0),T().setInt32(e+4*0,s,!0)},r.wbg.__wbg_static_accessor_GLOBAL_8921f820c2ce3f12=function(){const e=typeof globalThis>"u"?null:globalThis;return m(e)?0:h(e)},r.wbg.__wbg_static_accessor_GLOBAL_THIS_f0a4409105898184=function(){const e=typeof globalThis>"u"?null:globalThis;return m(e)?0:h(e)},r.wbg.__wbg_static_accessor_SELF_995b214ae681ff99=function(){const e=typeof self>"u"?null:self;return m(e)?0:h(e)},r.wbg.__wbg_static_accessor_WINDOW_cde3890479c675ea=function(){const e=typeof window>"u"?null:window;return m(e)?0:h(e)},r.wbg.__wbg_status_3fea3036088621d6=function(e){return e.status},r.wbg.__wbg_syncresult_new=function(e){return E.__wrap(e)},r.wbg.__wbg_text_0f69a215637b9b34=function(){return y(function(e){return e.text()},arguments)},r.wbg.__wbg_then_b33a773d723afa3e=function(e,t,n){return e.then(t,n)},r.wbg.__wbg_then_e22500defe16819f=function(e,t){return e.then(t)},r.wbg.__wbg_wbindgencbdrop_eb10308566512b88=function(e){const t=e.original;return t.cnt--==1?(t.a=0,!0):!1},r.wbg.__wbg_wbindgenisfunction_8cee7dce3725ae74=function(e){return typeof e=="function"},r.wbg.__wbg_wbindgenisundefined_c4b71d073b92f3c5=function(e){return e===void 0},r.wbg.__wbg_wbindgenstringget_0f16a6ddddef376f=function(e,t){const n=t,s=typeof n=="string"?n:void 0;var o=m(s)?0:u(s,i.__wbindgen_malloc,i.__wbindgen_realloc),a=d;T().setInt32(e+4*1,a,!0),T().setInt32(e+4*0,o,!0)},r.wbg.__wbg_wbindgenthrow_451ec1a8469d7eb6=function(e,t){throw new Error(l(e,t))},r.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){return l(e,t)},r.wbg.__wbindgen_cast_ff9305a84a3b238b=function(e,t){return N(e,t,36,q)},r.wbg.__wbindgen_init_externref_table=function(){const e=i.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},r}function Y(r,e){return i=r.exports,k.__wbindgen_wasm_module=e,g=null,v=null,i.__wbindgen_start(),i}async function k(r){if(i!==void 0)return i;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("/assets/eventbook_wasm_bg-hTGaDTye.wasm",import.meta.url));const e=X();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await G(await r,e);return Y(t,n)}class K{constructor(){this.client=null,this.wasmInitialized=!1,this.serverUrl="http://localhost:3000",console.log("EventBook client connecting to:",this.serverUrl)}async init(){try{await k(),this.client=new $(this.serverUrl),this.wasmInitialized=!0,this.updateWasmStatus("success","✅ WASM module loaded successfully"),this.setupEventHandlers(),await this.syncEventLog()}catch(e){console.error("Failed to initialize WASM:",e),this.updateWasmStatus("error",`❌ WASM initialization failed: ${e.message}`)}}setupEventHandlers(){document.getElementById("eventForm").addEventListener("submit",async e=>{e.preventDefault(),await this.submitEvent()}),window.syncEventLog=()=>this.syncEventLog(),window.rebuildProjections=()=>this.rebuildProjections(),window.fetchEvents=()=>this.fetchEvents(),window.showMaterializedUsers=()=>this.showMaterializedUsers(),window.runDemo=()=>this.runDemo(),window.fillSampleData=()=>this.fillSampleData()}updateWasmStatus(e,t){const n=document.getElementById("wasmStatus");n.innerHTML=`<div class="status ${e}">${t}</div>`}updateSyncStatus(e,t){const n=document.getElementById("syncStatus");n.innerHTML=`<div class="status ${e}">${t}</div>`,e==="success"&&setTimeout(()=>n.innerHTML="",3e3)}updateSubmitStatus(e,t){const n=document.getElementById("submitStatus");n.innerHTML=`<div class="status ${e}">${t}</div>`,e==="success"&&setTimeout(()=>n.innerHTML="",3e3)}async submitEvent(){if(!this.wasmInitialized){this.updateSubmitStatus("error","WASM not initialized");return}try{const e=document.getElementById("eventType").value,t=document.getElementById("aggregateId").value,n=document.getElementById("payload").value;try{P(n)}catch(o){this.updateSubmitStatus("error",`Invalid JSON: ${o.message}`);return}const s=this.client.submit_event(e,t,n);this.updateSubmitStatus("success",`✅ Event ${s.id} added locally (v${s.version})`),await this.sendEventToServer(e,t,JSON.parse(n)),this.showLocalEvents(),this.showMaterializedUsers()}catch(e){console.error("Submit error:",e),this.updateSubmitStatus("error",`❌ ${e.message}`)}}async sendEventToServer(e,t,n){try{const s=await fetch(`${this.serverUrl}/events`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_type:e,aggregate_id:t,payload:n})});if(!s.ok)throw new Error(`Server error: ${s.status}`)}catch(s){console.warn("Failed to sync to server:",s.message)}}async syncEventLog(){if(this.wasmInitialized)try{this.updateSyncStatus("info","🔄 Syncing event log from server...");const e=await fetch(`${this.serverUrl}/events`);if(!e.ok)throw new Error(`HTTP ${e.status}`);const n=(await e.json()).events||[];this.client.clear_local_store();let s=0;for(const o of n)try{this.client.submit_event(o.event_type,o.aggregate_id,JSON.stringify(o.payload)),s++}catch(a){console.warn("Failed to sync event:",o.id,a)}this.updateSyncStatus("success",`✅ Synced ${s} events from server`),this.showLocalEvents(),this.showMaterializedUsers()}catch(e){console.error("Sync failed:",e),this.updateSyncStatus("error",`❌ Sync failed: ${e.message}`)}}async rebuildProjections(){if(this.wasmInitialized)try{const e=this.client.rebuild_projections();this.updateSyncStatus("success",`🔨 Rebuilt projections from ${e} events`),this.showMaterializedUsers()}catch(e){this.updateSyncStatus("error",`❌ Rebuild failed: ${e.message}`)}}async fetchEvents(){this.showLocalEvents()}showLocalEvents(){if(this.wasmInitialized)try{const e=this.client.get_events(),t=document.getElementById("eventLog");if(e.length===0){t.innerHTML='<div class="loading">No events in local store</div>';return}const n=e.map(s=>`
                <div class="event-item">
                    <div class="event-header">
                        <span class="event-type-badge">${s.event_type}</span>
                        <span class="event-meta">v${s.version} • ${s.aggregate_id}</span>
                    </div>
                    <div class="event-meta">
                        ${new Date(s.timestamp*1e3).toLocaleString()} • ${s.id}
                    </div>
                    <div class="event-payload">${s.payload}</div>
                </div>
            `).join("");t.innerHTML=n}catch(e){console.error("Failed to show events:",e)}}showMaterializedUsers(){if(this.wasmInitialized)try{const e=this.client.get_materialized_users(),t=document.getElementById("materializedUsers"),n=document.getElementById("userStats"),s=document.getElementById("statsText");if(e.length===0){t.innerHTML='<div class="loading">No users materialized</div>',n.style.display="none";return}const o=e.map(c=>`
                <div class="user-item">
                    <div class="user-info">
                        <h4>${c.name}</h4>
                        <div class="email">${c.email}</div>
                    </div>
                    <div class="user-status">
                        <span class="${c.active?"active-badge":"inactive-badge"}">
                            ${c.active?"Active":"Inactive"}
                        </span>
                        <div>Created: ${new Date(c.created_at*1e3).toLocaleDateString()}</div>
                        ${c.created_at!==c.updated_at?`<div>Updated: ${new Date(c.updated_at*1e3).toLocaleDateString()}</div>`:""}
                    </div>
                </div>
            `).join("");t.innerHTML=o;const a=this.client.get_event_count(),_=this.client.get_user_count();s.textContent=`${_} users materialized from ${a} events`,n.style.display="block"}catch(e){console.error("Failed to show materialized users:",e)}}fillSampleData(){const e=Date.now();document.getElementById("eventType").value="UserCreated",document.getElementById("aggregateId").value=`user-${e}`,document.getElementById("payload").value=JSON.stringify({name:"Alice Johnson",email:`alice.${e}@example.com`},null,2)}async runDemo(){const e=document.getElementById("demoStatus");try{e.innerHTML='<div class="status info">🎬 Running event sourcing demo...</div>',this.client.clear_local_store();const t=`demo-user-${Date.now()}`,n=[{type:"UserCreated",payload:{name:"Demo User",email:"demo@example.com"}},{type:"UserUpdated",payload:{name:"Updated Demo User",email:"updated.demo@example.com"}},{type:"UserUpdated",payload:{name:"Final Demo User"}}];for(let s=0;s<n.length;s++){const o=n[s];this.client.submit_event(o.type,t,JSON.stringify(o.payload)),e.innerHTML=`<div class="status info">📝 Added event ${s+1}/${n.length}: ${o.type}</div>`,this.showLocalEvents(),this.showMaterializedUsers(),s<n.length-1&&await new Promise(a=>setTimeout(a,1e3))}e.innerHTML='<div class="status success">🎉 Demo complete! Notice how the user state evolved from the event sequence.</div>',setTimeout(()=>e.innerHTML="",5e3)}catch(t){console.error("Demo failed:",t),e.innerHTML=`<div class="status error">❌ Demo failed: ${t.message}</div>`}}}document.addEventListener("DOMContentLoaded",async()=>{await new K().init()});
