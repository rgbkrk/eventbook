(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const _ of i.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&r(_)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();let o,A=null;function L(){return(A===null||A.byteLength===0)&&(A=new Uint8Array(o.memory.buffer)),A}let I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});I.decode();const J=2146435072;let z=0;function q(n,e){return z+=e,z>=J&&(I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),I.decode(),z=e),I.decode(L().subarray(n,n+e))}function d(n,e){return n=n>>>0,q(n,e)}function a(n,e){try{return n.apply(this,e)}catch(t){let r=function(){try{return t instanceof Error?`${t.message}

Stack:
${t.stack}`:t.toString()}catch{return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",r),t}}function $(n){const e=o.__externref_table_alloc();return o.__wbindgen_export_2.set(e,n),e}function E(n,e){try{return n.apply(this,e)}catch(t){const r=$(t);o.__wbindgen_exn_store(r)}}function p(n){if(typeof n!="boolean")throw new Error(`expected a boolean argument, found ${typeof n}`)}function c(n){if(typeof n!="number")throw new Error(`expected a number argument, found ${typeof n}`)}let g=0;const T=new TextEncoder;"encodeInto"in T||(T.encodeInto=function(n,e){const t=T.encode(n);return e.set(t),{read:n.length,written:t.length}});function w(n,e,t){if(typeof n!="string")throw new Error(`expected a string argument, found ${typeof n}`);if(t===void 0){const l=T.encode(n),u=e(l.length,1)>>>0;return L().subarray(u,u+l.length).set(l),g=l.length,u}let r=n.length,s=e(r,1)>>>0;const i=L();let _=0;for(;_<r;_++){const l=n.charCodeAt(_);if(l>127)break;i[s+_]=l}if(_!==r){_!==0&&(n=n.slice(_)),s=t(s,r,r=_+n.length*3,1)>>>0;const l=L().subarray(s+_,s+r),u=T.encodeInto(n,l);if(u.read!==n.length)throw new Error("failed to pass whole string");_+=u.written,s=t(s,r,_,1)>>>0}return g=_,s}let f=null;function m(){return(f===null||f.buffer.detached===!0||f.buffer.detached===void 0&&f.buffer!==o.memory.buffer)&&(f=new DataView(o.memory.buffer)),f}function S(n){return n==null}function k(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const s=n.description;return s==null?"Symbol":`Symbol(${s})`}if(e=="function"){const s=n.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(n)){const s=n.length;let i="[";s>0&&(i+=k(n[0]));for(let _=1;_<s;_++)i+=", "+k(n[_]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}const D=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{o.__wbindgen_export_6.get(n.dtor)(n.a,n.b)});function V(n,e,t,r){const s={a:n,b:e,cnt:1,dtor:t},i=(..._)=>{s.cnt++;const l=s.a;s.a=0;try{return r(l,s.b,..._)}finally{--s.cnt===0?(o.__wbindgen_export_6.get(s.dtor)(l,s.b),D.unregister(s)):s.a=l}};return i.original=s,D.register(i,s,s),i}function b(n){const e=o.__wbindgen_export_2.get(n);return o.__externref_table_dealloc(n),e}function X(n){const e=w(n,o.__wbindgen_malloc,o.__wbindgen_realloc),t=g,r=o.validate_json_payload(e,t);if(r[1])throw b(r[0])}function G(n,e,t){c(n),c(e),o.closure29_externref_shim(n,e,t)}function K(n,e,t,r){c(n),c(e),o.closure52_externref_shim(n,e,t,r)}const R=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>o.__wbg_eventbookclient_free(n>>>0,1));class x{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_eventbookclient_free(e,0)}constructor(e){const t=w(e,o.__wbindgen_malloc,o.__wbindgen_realloc),r=g,s=o.eventbookclient_new(t,r);return this.__wbg_ptr=s>>>0,R.register(this,this.__wbg_ptr,this),this}submit_event(e,t,r){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const s=w(e,o.__wbindgen_malloc,o.__wbindgen_realloc),i=g,_=w(t,o.__wbindgen_malloc,o.__wbindgen_realloc),l=g,u=w(r,o.__wbindgen_malloc,o.__wbindgen_realloc),M=g,v=o.eventbookclient_submit_event(this.__wbg_ptr,s,i,_,l,u,M);if(v[2])throw b(v[1]);return h.__wrap(v[0])}get_events(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const e=o.eventbookclient_get_events(this.__wbg_ptr);if(e[2])throw b(e[1]);return b(e[0])}get_events_for_aggregate(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const t=w(e,o.__wbindgen_malloc,o.__wbindgen_realloc),r=g,s=o.eventbookclient_get_events_for_aggregate(this.__wbg_ptr,t,r);if(s[2])throw b(s[1]);return b(s[0])}get_materialized_users(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.eventbookclient_get_materialized_users(this.__wbg_ptr)}get_materialized_user(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const t=w(e,o.__wbindgen_malloc,o.__wbindgen_realloc),r=g,s=o.eventbookclient_get_materialized_user(this.__wbg_ptr,t,r);return s===0?void 0:y.__wrap(s)}get_user_count(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.eventbookclient_get_user_count(this.__wbg_ptr)>>>0}get_event_count(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.eventbookclient_get_event_count(this.__wbg_ptr)>>>0}clear_local_store(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr),o.eventbookclient_clear_local_store(this.__wbg_ptr)}rebuild_projections(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const e=o.eventbookclient_rebuild_projections(this.__wbg_ptr);if(e[2])throw b(e[1]);return e[0]>>>0}sync_event_log(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.eventbookclient_sync_event_log(this.__wbg_ptr)}}Symbol.dispose&&(x.prototype[Symbol.dispose]=x.prototype.free);const O=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>o.__wbg_jsevent_free(n>>>0,1));class h{static __wrap(e){e=e>>>0;const t=Object.create(h.prototype);return t.__wbg_ptr=e,O.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,O.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_jsevent_free(e,0)}constructor(e,t,r,s,i,_){const l=w(e,o.__wbindgen_malloc,o.__wbindgen_realloc),u=g,M=w(t,o.__wbindgen_malloc,o.__wbindgen_realloc),v=g,W=w(r,o.__wbindgen_malloc,o.__wbindgen_realloc),H=g,N=w(s,o.__wbindgen_malloc,o.__wbindgen_realloc),C=g,P=o.jsevent_new(l,u,M,v,W,H,N,C,i,_);return this.__wbg_ptr=P>>>0,O.register(this,this.__wbg_ptr,this),this}get id(){let e,t;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const r=o.jsevent_id(this.__wbg_ptr);return e=r[0],t=r[1],d(r[0],r[1])}finally{o.__wbindgen_free(e,t,1)}}get event_type(){let e,t;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const r=o.jsevent_event_type(this.__wbg_ptr);return e=r[0],t=r[1],d(r[0],r[1])}finally{o.__wbindgen_free(e,t,1)}}get aggregate_id(){let e,t;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const r=o.jsevent_aggregate_id(this.__wbg_ptr);return e=r[0],t=r[1],d(r[0],r[1])}finally{o.__wbindgen_free(e,t,1)}}get payload(){let e,t;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const r=o.jsevent_payload(this.__wbg_ptr);return e=r[0],t=r[1],d(r[0],r[1])}finally{o.__wbindgen_free(e,t,1)}}get timestamp(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.jsevent_timestamp(this.__wbg_ptr)}get version(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.jsevent_version(this.__wbg_ptr)}}Symbol.dispose&&(h.prototype[Symbol.dispose]=h.prototype.free);const U=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>o.__wbg_jsuser_free(n>>>0,1));class y{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(y.prototype);return t.__wbg_ptr=e,U.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,U.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_jsuser_free(e,0)}get id(){let e,t;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const r=o.jsuser_id(this.__wbg_ptr);return e=r[0],t=r[1],d(r[0],r[1])}finally{o.__wbindgen_free(e,t,1)}}get name(){let e,t;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const r=o.jsuser_name(this.__wbg_ptr);return e=r[0],t=r[1],d(r[0],r[1])}finally{o.__wbindgen_free(e,t,1)}}get email(){let e,t;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const r=o.jsuser_email(this.__wbg_ptr);return e=r[0],t=r[1],d(r[0],r[1])}finally{o.__wbindgen_free(e,t,1)}}get created_at(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.jsuser_created_at(this.__wbg_ptr)}get updated_at(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.jsuser_updated_at(this.__wbg_ptr)}get active(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.jsuser_active(this.__wbg_ptr)!==0}}Symbol.dispose&&(y.prototype[Symbol.dispose]=y.prototype.free);const F=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>o.__wbg_syncresult_free(n>>>0,1));class j{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(j.prototype);return t.__wbg_ptr=e,F.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,F.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_syncresult_free(e,0)}get events_pulled(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.syncresult_events_pulled(this.__wbg_ptr)>>>0}get success(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return c(this.__wbg_ptr),o.syncresult_success(this.__wbg_ptr)!==0}get error_message(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");c(this.__wbg_ptr);const e=o.syncresult_error_message(this.__wbg_ptr);let t;return e[0]!==0&&(t=d(e[0],e[1]).slice(),o.__wbindgen_free(e[0],e[1]*1,1)),t}}Symbol.dispose&&(j.prototype[Symbol.dispose]=j.prototype.free);const Y=new Set(["basic","cors","default"]);async function Q(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.ok&&Y.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function Z(){const n={};return n.wbg={},n.wbg.__wbg_Error_e17e777aac105295=function(){return a(function(e,t){return Error(d(e,t))},arguments)},n.wbg.__wbg_call_13410aac570ffff7=function(){return E(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_call_a5400b25a865cfd8=function(){return E(function(e,t,r){return e.call(t,r)},arguments)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(){return a(function(e,t){let r,s;try{r=e,s=t,console.error(d(e,t))}finally{o.__wbindgen_free(r,s,1)}},arguments)},n.wbg.__wbg_fetch_44b6058021aef5e3=function(){return a(function(e,t){return e.fetch(t)},arguments)},n.wbg.__wbg_headers_af04c3eb495104ed=function(){return a(function(e){return e.headers},arguments)},n.wbg.__wbg_instanceof_Response_50fde2cd696850bf=function(){return a(function(e){let t;try{t=e instanceof Response}catch{t=!1}const r=t;return p(r),r},arguments)},n.wbg.__wbg_instanceof_Window_12d20d558ef92592=function(){return a(function(e){let t;try{t=e instanceof Window}catch{t=!1}const r=t;return p(r),r},arguments)},n.wbg.__wbg_jsevent_new=function(){return a(function(e){return h.__wrap(e)},arguments)},n.wbg.__wbg_jsuser_new=function(){return a(function(e){return y.__wrap(e)},arguments)},n.wbg.__wbg_log_6c7b5f4f00b8ce3f=function(){return a(function(e){console.log(e)},arguments)},n.wbg.__wbg_new_19c25a3f2fa63a02=function(){return a(function(){return new Object},arguments)},n.wbg.__wbg_new_1f3a344cf3123716=function(){return a(function(){return new Array},arguments)},n.wbg.__wbg_new_2e3c58a15f39f5f9=function(){return a(function(e,t){try{var r={a:e,b:t},s=(_,l)=>{const u=r.a;r.a=0;try{return K(u,r.b,_,l)}finally{r.a=u}};return new Promise(s)}finally{r.a=r.b=0}},arguments)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return a(function(){return new Error},arguments)},n.wbg.__wbg_newnoargs_254190557c45b4ec=function(){return a(function(e,t){return new Function(d(e,t))},arguments)},n.wbg.__wbg_newwithstrandinit_b5d168a29a3fd85f=function(){return E(function(e,t,r){return new Request(d(e,t),r)},arguments)},n.wbg.__wbg_ok_2eac216b65d90573=function(){return a(function(e){const t=e.ok;return p(t),t},arguments)},n.wbg.__wbg_push_330b2eb93e4e1212=function(){return a(function(e,t){const r=e.push(t);return c(r),r},arguments)},n.wbg.__wbg_queueMicrotask_25d0739ac89e8c88=function(){return a(function(e){queueMicrotask(e)},arguments)},n.wbg.__wbg_queueMicrotask_4488407636f5bf24=function(){return a(function(e){return e.queueMicrotask},arguments)},n.wbg.__wbg_resolve_4055c623acdd6a1b=function(){return a(function(e){return Promise.resolve(e)},arguments)},n.wbg.__wbg_set_1c17f9738fac2718=function(){return E(function(e,t,r,s,i){e.set(d(t,r),d(s,i))},arguments)},n.wbg.__wbg_setmethod_9b504d5b855b329c=function(){return a(function(e,t,r){e.method=d(t,r)},arguments)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(){return a(function(e,t){const r=t.stack,s=w(r,o.__wbindgen_malloc,o.__wbindgen_realloc),i=g;m().setInt32(e+4*1,i,!0),m().setInt32(e+4*0,s,!0)},arguments)},n.wbg.__wbg_static_accessor_GLOBAL_8921f820c2ce3f12=function(){return a(function(){const e=typeof globalThis>"u"?null:globalThis;return S(e)?0:$(e)},arguments)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_f0a4409105898184=function(){return a(function(){const e=typeof globalThis>"u"?null:globalThis;return S(e)?0:$(e)},arguments)},n.wbg.__wbg_static_accessor_SELF_995b214ae681ff99=function(){return a(function(){const e=typeof self>"u"?null:self;return S(e)?0:$(e)},arguments)},n.wbg.__wbg_static_accessor_WINDOW_cde3890479c675ea=function(){return a(function(){const e=typeof window>"u"?null:window;return S(e)?0:$(e)},arguments)},n.wbg.__wbg_status_3fea3036088621d6=function(){return a(function(e){const t=e.status;return c(t),t},arguments)},n.wbg.__wbg_syncresult_new=function(){return a(function(e){return j.__wrap(e)},arguments)},n.wbg.__wbg_text_0f69a215637b9b34=function(){return E(function(e){return e.text()},arguments)},n.wbg.__wbg_then_b33a773d723afa3e=function(){return a(function(e,t,r){return e.then(t,r)},arguments)},n.wbg.__wbg_then_e22500defe16819f=function(){return a(function(e,t){return e.then(t)},arguments)},n.wbg.__wbg_wbindgencbdrop_eb10308566512b88=function(e){const t=e.original;if(t.cnt--==1)return t.a=0,!0;const r=!1;return p(r),r},n.wbg.__wbg_wbindgendebugstring_99ef257a3ddda34d=function(e,t){const r=k(t),s=w(r,o.__wbindgen_malloc,o.__wbindgen_realloc),i=g;m().setInt32(e+4*1,i,!0),m().setInt32(e+4*0,s,!0)},n.wbg.__wbg_wbindgenisfunction_8cee7dce3725ae74=function(e){const t=typeof e=="function";return p(t),t},n.wbg.__wbg_wbindgenisundefined_c4b71d073b92f3c5=function(e){const t=e===void 0;return p(t),t},n.wbg.__wbg_wbindgenstringget_0f16a6ddddef376f=function(e,t){const r=t,s=typeof r=="string"?r:void 0;var i=S(s)?0:w(s,o.__wbindgen_malloc,o.__wbindgen_realloc),_=g;m().setInt32(e+4*1,_,!0),m().setInt32(e+4*0,i,!0)},n.wbg.__wbg_wbindgenthrow_451ec1a8469d7eb6=function(e,t){throw new Error(d(e,t))},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(){return a(function(e,t){return d(e,t)},arguments)},n.wbg.__wbindgen_cast_fc3da82b7ff1aaaf=function(){return a(function(e,t){return V(e,t,28,G)},arguments)},n.wbg.__wbindgen_init_externref_table=function(){const e=o.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n}function ee(n,e){return o=n.exports,B.__wbindgen_wasm_module=e,f=null,A=null,o.__wbindgen_start(),o}async function B(n){if(o!==void 0)return o;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/assets/eventbook_wasm_bg-IK0xXb89.wasm",import.meta.url));const e=Z();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await Q(await n,e);return ee(t,r)}class te{constructor(){this.client=null,this.wasmInitialized=!1,this.serverUrl=window.location.origin.replace(":5173",":3000")}async init(){try{await B(),this.client=new x(this.serverUrl),this.wasmInitialized=!0,this.updateWasmStatus("success","✅ WASM module loaded successfully"),this.setupEventHandlers(),await this.syncEventLog()}catch(e){console.error("Failed to initialize WASM:",e),this.updateWasmStatus("error",`❌ WASM initialization failed: ${e.message}`)}}setupEventHandlers(){document.getElementById("eventForm").addEventListener("submit",async e=>{e.preventDefault(),await this.submitEvent()}),window.syncEventLog=()=>this.syncEventLog(),window.rebuildProjections=()=>this.rebuildProjections(),window.fetchEvents=()=>this.fetchEvents(),window.showMaterializedUsers=()=>this.showMaterializedUsers(),window.runDemo=()=>this.runDemo(),window.fillSampleData=()=>this.fillSampleData()}updateWasmStatus(e,t){const r=document.getElementById("wasmStatus");r.innerHTML=`<div class="status ${e}">${t}</div>`}updateSyncStatus(e,t){const r=document.getElementById("syncStatus");r.innerHTML=`<div class="status ${e}">${t}</div>`,e==="success"&&setTimeout(()=>r.innerHTML="",3e3)}updateSubmitStatus(e,t){const r=document.getElementById("submitStatus");r.innerHTML=`<div class="status ${e}">${t}</div>`,e==="success"&&setTimeout(()=>r.innerHTML="",3e3)}async submitEvent(){if(!this.wasmInitialized){this.updateSubmitStatus("error","WASM not initialized");return}try{const e=document.getElementById("eventType").value,t=document.getElementById("aggregateId").value,r=document.getElementById("payload").value;try{X(r)}catch(i){this.updateSubmitStatus("error",`Invalid JSON: ${i.message}`);return}const s=this.client.submit_event(e,t,r);this.updateSubmitStatus("success",`✅ Event ${s.id} added locally (v${s.version})`),await this.sendEventToServer(e,t,JSON.parse(r)),this.showLocalEvents(),this.showMaterializedUsers()}catch(e){console.error("Submit error:",e),this.updateSubmitStatus("error",`❌ ${e.message}`)}}async sendEventToServer(e,t,r){try{const s=await fetch(`${this.serverUrl}/events`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_type:e,aggregate_id:t,payload:r})});if(!s.ok)throw new Error(`Server error: ${s.status}`)}catch(s){console.warn("Failed to sync to server:",s.message)}}async syncEventLog(){if(this.wasmInitialized)try{this.updateSyncStatus("info","🔄 Syncing event log from server...");const e=await fetch(`${this.serverUrl}/events`);if(!e.ok)throw new Error(`HTTP ${e.status}`);const r=(await e.json()).events||[];this.client.clear_local_store();let s=0;for(const i of r)try{this.client.submit_event(i.event_type,i.aggregate_id,JSON.stringify(i.payload)),s++}catch(_){console.warn("Failed to sync event:",i.id,_)}this.updateSyncStatus("success",`✅ Synced ${s} events from server`),this.showLocalEvents(),this.showMaterializedUsers()}catch(e){console.error("Sync failed:",e),this.updateSyncStatus("error",`❌ Sync failed: ${e.message}`)}}async rebuildProjections(){if(this.wasmInitialized)try{const e=this.client.rebuild_projections();this.updateSyncStatus("success",`🔨 Rebuilt projections from ${e} events`),this.showMaterializedUsers()}catch(e){this.updateSyncStatus("error",`❌ Rebuild failed: ${e.message}`)}}async fetchEvents(){this.showLocalEvents()}showLocalEvents(){if(this.wasmInitialized)try{const e=this.client.get_events(),t=document.getElementById("eventLog");if(e.length===0){t.innerHTML='<div class="loading">No events in local store</div>';return}const r=e.map(s=>`
                <div class="event-item">
                    <div class="event-header">
                        <span class="event-type-badge">${s.event_type}</span>
                        <span class="event-meta">v${s.version} • ${s.aggregate_id}</span>
                    </div>
                    <div class="event-meta">
                        ${new Date(s.timestamp*1e3).toLocaleString()} • ${s.id}
                    </div>
                    <div class="event-payload">${s.payload}</div>
                </div>
            `).join("");t.innerHTML=r}catch(e){console.error("Failed to show events:",e)}}showMaterializedUsers(){if(this.wasmInitialized)try{const e=this.client.get_materialized_users(),t=document.getElementById("materializedUsers"),r=document.getElementById("userStats"),s=document.getElementById("statsText");if(e.length===0){t.innerHTML='<div class="loading">No users materialized</div>',r.style.display="none";return}const i=e.map(u=>`
                <div class="user-item">
                    <div class="user-info">
                        <h4>${u.name}</h4>
                        <div class="email">${u.email}</div>
                    </div>
                    <div class="user-status">
                        <span class="${u.active?"active-badge":"inactive-badge"}">
                            ${u.active?"Active":"Inactive"}
                        </span>
                        <div>Created: ${new Date(u.created_at*1e3).toLocaleDateString()}</div>
                        ${u.created_at!==u.updated_at?`<div>Updated: ${new Date(u.updated_at*1e3).toLocaleDateString()}</div>`:""}
                    </div>
                </div>
            `).join("");t.innerHTML=i;const _=this.client.get_event_count(),l=this.client.get_user_count();s.textContent=`${l} users materialized from ${_} events`,r.style.display="block"}catch(e){console.error("Failed to show materialized users:",e)}}fillSampleData(){const e=Date.now();document.getElementById("eventType").value="UserCreated",document.getElementById("aggregateId").value=`user-${e}`,document.getElementById("payload").value=JSON.stringify({name:"Alice Johnson",email:`alice.${e}@example.com`},null,2)}async runDemo(){const e=document.getElementById("demoStatus");try{e.innerHTML='<div class="status info">🎬 Running event sourcing demo...</div>',this.client.clear_local_store();const t=`demo-user-${Date.now()}`,r=[{type:"UserCreated",payload:{name:"Demo User",email:"demo@example.com"}},{type:"UserUpdated",payload:{name:"Updated Demo User",email:"updated.demo@example.com"}},{type:"UserUpdated",payload:{name:"Final Demo User"}}];for(let s=0;s<r.length;s++){const i=r[s];this.client.submit_event(i.type,t,JSON.stringify(i.payload)),e.innerHTML=`<div class="status info">📝 Added event ${s+1}/${r.length}: ${i.type}</div>`,this.showLocalEvents(),this.showMaterializedUsers(),s<r.length-1&&await new Promise(_=>setTimeout(_,1e3))}e.innerHTML='<div class="status success">🎉 Demo complete! Notice how the user state evolved from the event sequence.</div>',setTimeout(()=>e.innerHTML="",5e3)}catch(t){console.error("Demo failed:",t),e.innerHTML=`<div class="status error">❌ Demo failed: ${t.message}</div>`}}}document.addEventListener("DOMContentLoaded",async()=>{await new te().init()});
